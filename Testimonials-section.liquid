{% stylesheet %}
.testimonial-slider-container {
  position: relative;
  max-width: 800px;
  margin: auto;
  text-align: center;
  padding: 40px 20px;
}

.testimonial-slide {
  display: none;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.testimonial-slide.active {
  display: block;
  opacity: 1;
}

.testimonial-quote {
  font-size: 20px;
  font-style: italic;
  margin-bottom: 20px;
}

.reviewer-info {
  font-size: 14px;
  color: #666;
}

.stars {
  margin: 10px 0;
}

.stars span {
  font-size: 18px;
  color: #f1c40f;
}

.slider-arrows {
  position: absolute;
  top: 50%;
  width: 100%;
  display: flex;
  justify-content: space-between;
  transform: translateY(-50%);
}

.slider-arrow {
  cursor: pointer;
  background: #fff;
  border: 1px solid #ddd;
  padding: 6px 12px;
  border-radius: 4px;
  font-size: 20px;
  user-select: none;
}

.slider-dots {
  margin-top: 20px;
}

.slider-dots span {
  height: 10px;
  width: 10px;
  margin: 3px;
  background: #ccc;
  display: inline-block;
  border-radius: 50%;
  cursor: pointer;
}

.slider-dots span.active-dot {
  background: #000;
}

.parent-block{
    display: flex;
}
{% endstylesheet %}

<div class="testimonial-slider-container" data-auto="{{ section.settings.autoslide }}" data-speed="{{ section.settings.speed }}">

  {% for block in section.blocks %}
    <div class="testimonial-slide {% if forloop.first %}active{% endif %}">
      <div class="testimonial-quote">“{{ block.settings.quote }}”</div>

      <div class="parent-block">
      <div class="stars">
        {% for i in (1..block.settings.stars) %}
          <span>★</span>
        {% endfor %}
      </div>

      <div class="reviewer-info">
        {{ block.settings.name }} — {{ block.settings.date }}
      </div>
    </div>
    </div>
  {% endfor %}

  <div class="slider-arrows">
    <div class="slider-arrow prev">‹</div>
    <div class="slider-arrow next">›</div>
  </div>

  <div class="slider-dots">
    {% for block in section.blocks %}
      <span class="dot {% if forloop.first %}active-dot{% endif %}" data-index="{{ forloop.index0 }}"></span>
    {% endfor %}
  </div>
</div>

{% javascript %}
document.addEventListener("DOMContentLoaded", function () {
  let container = document.querySelector(".testimonial-slider-container");
  let slides = document.querySelectorAll(".testimonial-slide");
  let dots = document.querySelectorAll(".slider-dots .dot");
  let next = document.querySelector(".slider-arrow.next");
  let prev = document.querySelector(".slider-arrow.prev");

  let index = 0;
  let autoslide = container.dataset.auto === "true";
  let speed = parseInt(container.dataset.speed) || 4000;
  let timer;

  function showSlide(i) {
    slides.forEach((slide, idx) => slide.classList.toggle("active", idx === i));
    dots.forEach((dot, idx) => dot.classList.toggle("active-dot", idx === i));
  }

  function nextSlide() {
    index = (index + 1) % slides.length;
    showSlide(index);
  }

  function prevSlide() {
    index = (index - 1 + slides.length) % slides.length;
    showSlide(index);
  }

  next.addEventListener("click", () => {
    nextSlide();
    resetTimer();
  });

  prev.addEventListener("click", () => {
    prevSlide();
    resetTimer();
  });

  dots.forEach(dot => {
    dot.addEventListener("click", () => {
      index = Number(dot.dataset.index);
      showSlide(index);
      resetTimer();
    });
  });

  function startAutoplay() {
    if (autoslide) {
      timer = setInterval(nextSlide, speed);
    }
  }

  function resetTimer() {
    if (autoslide) {
      clearInterval(timer);
      startAutoplay();
    }
  }

  startAutoplay();
});
{% endjavascript %}

{% schema %}
{
  "name": "Testimonial Slider",
  "settings": [
    {
      "type": "checkbox",
      "id": "autoslide",
      "label": "Enable Auto Slide",
      "default": false
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Auto Slide Speed (ms)",
      "min": 2000,
      "max": 9500,
      "step": 500,
      "default": 4000
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "textarea", "id": "quote", "label": "Quote" },
        { "type": "range", "id": "stars", "label": "Star Rating", "min": 1, "max": 5, "default": 5 },
        { "type": "text", "id": "name", "label": "Reviewer Name" },
        { "type": "text", "id": "date", "label": "Date", "default": "2025" }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    { "name": "Testimonial Slider" }
  ]
}
{% endschema %}
